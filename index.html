<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Country Leaderboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #74ebd5, #9face6);
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0;
    color: white;
  }
  button { 
    padding: 12px 24px; 
    font-size: 16px; 
    border: none; 
    border-radius: 8px; 
    background: #4a90e2; 
    cursor: pointer; 
    margin-top: 10px; 
  }
  table { 
    margin-top: 20px; 
    border-collapse: collapse; 
    background: rgba(0,0,0,0.3);
  }
  td, th { 
    padding: 8px 16px; 
    border: 1px solid #fff; 
  }
</style>
</head>
<body>

<h1>Country Leaderboard</h1>
<p id="country">Detecting your country...</p>
<button id="addPoint">Add 1 Point</button>

<table id="leaderboard">
  <thead>
    <tr><th>Country</th><th>Points</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let userCountry = "";
const leaderboardBody = document.querySelector("#leaderboard tbody");
const addBtn = document.getElementById("addPoint");

// Replace with your deployed backend URL
const BACKEND_URL = "https://savvas767.github.io/Detector/";

// Detect country
fetch("https://ipwho.is/")
  .then(res => res.json())
  .then(data => {
    if(data.success){
      userCountry = data.country;
      document.getElementById("country").textContent = "Your country: " + userCountry;
    } else {
      document.getElementById("country").textContent = "Could not detect country";
      addBtn.disabled = true;
    }
  })
  .catch(err => {
    console.error(err);
    document.getElementById("country").textContent = "Could not detect country";
    addBtn.disabled = true;
  });

// Add 1 point
addBtn.addEventListener("click", () => {
  if(!userCountry) return;

  fetch(BACKEND_URL + "/add-point", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ country: userCountry })
  })
  .then(res => res.json())
  .then(data => console.log("Point added!", data))
  .catch(err => console.error("Error adding point:", err));
});

// Update leaderboard
function updateLeaderboard() {
  fetch(BACKEND_URL + "/leaderboard")
    .then(res => res.json())
    .then(sorted => {
      leaderboardBody.innerHTML = "";
      sorted.forEach(([country, points]) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${country}</td><td>${points}</td>`;
        leaderboardBody.appendChild(row);
      });
    })
    .catch(err => console.error("Error fetching leaderboard:", err));
}

// Refresh leaderboard every 5 seconds
setInterval(updateLeaderboard, 5000);
updateLeaderboard();
</script>

</body>
</html>
